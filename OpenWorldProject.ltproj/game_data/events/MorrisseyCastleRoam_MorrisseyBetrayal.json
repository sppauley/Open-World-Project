[
    {
        "name": "MorrisseyBetrayal",
        "trigger": "on_talk",
        "level_nid": "MorrisseyCastleRoam",
        "condition": "unit2.nid=='Morrissey' and v(\"EndingAvailable\") == True",
        "commands": [],
        "only_once": false,
        "priority": 20,
        "_source": [
            "music_clear;2000",
            "",
            "move_unit;Simon;16,7",
            "",
            "add_portrait;Simon;Left;normal;CloseEyes",
            "s;Simon;If I speak to Morrissey now...{w} If he has betrayed me, there's no turning back.|Am I really ready?;;;thought_bubble",
            "choice;BeginEnding;Speak to Morrissey?;Yes,No",
            "",
            "if;v(\"_last_choice\") == \"Yes\"",
            "",
            "remove_portrait;Simon",
            "move_unit;Simon;Morrissey;normal;closest",
            "",
            "add_portrait;Simon;Left",
            "add_portrait;Morrissey;Right",
            "",
            "s;Morrissey;Lord Verstadt! I'm glad to see you here safe.|I heard about what happened at the capital.",
            "s;Simon;Yes, both us and the king's guard were... caught by surprise.",
            "s;Morrissey;I've had my men try and investigate that artifact further.|We-",
            "wait;400",
            "expression;Morrissey;CloseEyes",
            "s;Morrissey;Dammit Simon, I'm sorry.{w} I wish I had known.|Or at least been there to aid you.",
            "s;Simon;You truly had no idea this would happen?",
            "s;Morrissey;None whatsoever.{w} Every archive we found indicated the device was purely alchemical.",
            "s;Simon;I see.",
            "",
            "expression;Morrissey;NormalBlink",
            "wait;100",
            "s;Morrissey;Come, let me prove it to you.|I owe you that, at the very least.",
            "",
            "sound;Unlock",
            "show_layer;secret",
            "",
            "s;Morrissey;Follow me.{w} I promise, I can explain everything.",
            "multi_remove_portrait;Morrissey;Simon",
            "",
            "move_unit;Morrissey;11,2;no_follow",
            "remove_unit;Morrissey",
            "wait;300",
            "move_unit;Simon;13,3",
            "wait;1000",
            "move_unit;Simon;11,2;no_follow",
            "wait;500",
            "remove_unit;Simon",
            "",
            "transition;close;1000",
            "remove_all_units",
            "change_tilemap;FatesRoom",
            "show_layer;overlay;immediate",
            "show_layer;overlay2;immediate",
            "add_unit;Morrissey;9,12;immediate",
            "move_unit;Morrissey;9,2;no_follow",
            "transition;open;300",
            "",
            "wait;200",
            "add_unit;Simon;9,12",
            "",
            "wait;500",
            "move_unit;Simon;9,7",
            "",
            "if;v(\"AtroposDestroyed\") == True and v(\"LachesisDestroyed\") == True and v(\"ClothoDestroyed\") == True and game.game_vars['AnukiLoyal']==True",
            "    game_var;FatesDefied;True",
            "end",
            "",
            "if;v(\"FatesDefied\") != True",
            "",
            "change_music;player_phase;59Silence",
            "add_portrait;Morrissey;Right",
            "s;Morrissey;Simon-",
            "remove_portrait;Morrissey;immediate",
            "",
            "has_finished;Morrissey",
            "change_team;Clotho;enemy2",
            "add_unit;Clotho;9,10;warp",
            "add_unit;Lachesis;2,4;warp",
            "add_unit;Atropos;15,5;warp",
            "",
            "add_portrait;Simon;Right",
            "s;Simon;What...",
            "remove_portrait;Simon",
            "wait;400",
            "",
            "game_var;EndingChosen;\"Atropos\"",
            "",
            "add_talk;Simon;Clotho",
            "add_talk;Simon;Atropos",
            "add_talk;Simon;Lachesis",
            "",
            "remove_talk;Simon;Morrissey",
            "",
            "# Not a typo: Simon has a \"double talk\" if he's unlocked verstadt castle",
            "remove_talk;Simon;Morrissey;no_warn",
            "",
            "else",
            "",
            "add_portrait;Morrissey;Right",
            "s;Morrissey;Simon, are you ready to continue?|The core of my library is past here.",
            "add_portrait;Simon;Left",
            "s;Simon;...Of course. Lead the way.",
            "multi_remove_portrait;Simon;Morrissey",
            "",
            "move_unit;Morrissey;9,0",
            "remove_unit;Morrissey",
            "",
            "wait;500",
            "",
            "move_unit;Simon;9,0",
            "wait;500",
            "remove_unit;Simon",
            "",
            "transition;close;1000",
            "",
            "game_var;_go_to_overworld_nid;None",
            "game_var;_goto_level;\"43\"",
            "win_game",
            "",
            "end",
            "",
            "end"
        ]
    }
]