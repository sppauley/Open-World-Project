[
    {
        "name": "BeginBattle",
        "trigger": "roaming_interrupt",
        "level_nid": "6",
        "condition": "unit.nid == \"Simon\"",
        "commands": [],
        "only_once": false,
        "priority": 20,
        "_source": [
            "add_portrait;Simon;MidLeft;left",
            "",
            "if;v(\"FlowerRecruited\")",
            "add_portrait;Flower;FarLeft;left",
            "speak;Flower;Awooooo!{w}{br}Grrr...",
            "mirror_portrait;Simon",
            "end",
            "",
            "speak;Simon;He must be up ahead.{w}{br}Best be ready.",
            "remove_portrait;Flower;no_warn",
            "",
            "choice;ApproachVilge;Begin the battle?;No,Yes;80",
            "",
            "if;v(\"_last_choice\") == \"Yes\"",
            "",
            "remove_region;VilgeArea",
            "#Dialogue",
            "remove_portrait;Simon;immediate",
            "add_portrait;Simon;Right",
            "speak;Simon;This is it. No more holding back.",
            "move_unit;Simon;12,6",
            "sound;Fimbulvetr1",
            "map_anim;AOE_Blizzard;11,6;0.5;no_block",
            "wait;200",
            "move_unit;Simon;13,6",
            "wait;800",
            "move_unit;Vilge;9,6;immediate",
            "move_unit;Vilge;10,6",
            "add_portrait;Vilge;Left",
            "speak;Vilge;And what, exactly, are you holding back?",
            "speak;Simon;You must be Vilge.",
            "speak;Vilge;And you must be a fool, challenging me here.",
            "speak;Simon;Whatever you're doing here, ends today.",
            "speak;Vilge;The ascensions?{w} Oh, don't tell me.{w}{br}Pelopos finally dispatched half-decent knights.{w}{br}Excellent, my current reserve is low.",
            "speak;Vilge;Bring up the shield!{w} And bring me their bodies!{w}{br}In as few pieces as possible.",
            "remove_portrait;Vilge",
            "move_unit;Simon;14,6;no_block",
            "move_unit;105;8,15;no_follow",
            "add_unit;101;12,6;warp;push;no_warn",
            "add_unit;102;13,6;warp;push;no_warn",
            "add_unit;103;12,7;warp;push;no_warn",
            "add_unit;104;13,7;warp;push;no_warn",
            "",
            "speak;Simon;Damn!{w} We can't get to him with these here.{w}{br}There must be some way through.",
            "add_portrait;Flower;Left",
            "s;Flower;Grrr...",
            "s;Simon;Don't worry, we'll find a way.",
            "multi_remove_portrait;Flower;Simon",
            "",
            "",
            "remove_portrait;Simon",
            "move_unit;Simon;16,7;no_block",
            "move_unit;Flower;17,7;no_follow",
            "move_unit;Vilge;4,5;immediate",
            "#Setup",
            "change_roaming;f",
            "remove_talk;Simon;122",
            "remove_talk;Simon;105",
            "remove_talk;Simon;116",
            "remove_unit;122;immediate;no_warn",
            "remove_unit;128;immediate;no_warn",
            "arrange_formation",
            "trigger_script;Global GenericPreps",
            "",
            "for;unit;[unit.nid for unit in game.units if not unit.dead and not unit.is_dying and 'Tile' not in unit.tags]",
            "reset;{unit}",
            "endf",
            "",
            "change_music;player_phase;Chaos",
            "change_music;enemy_phase;Chaos",
            "change_music;enemy2_phase;Chaos",
            "change_music;other_phase;Chaos",
            "",
            "if;game.get_unit(\"Nika\").position",
            "add_portrait;Nika;Left",
            "speak;Nika;Sorry, Simon...{w} I can't-{w}{br}Keep...",
            "add_unit_map_anim;MapBerserk;Nika;permanent",
            "give_skill;Nika;NikaBerserk;no_banner",
            "give_skill;Nika;StaggerGaleforce;no_banner",
            "remove_portrait;Nika",
            "add_portrait;Simon;Right",
            "speak;Simon;Nika?{w} ..?{w} Everyone, be careful.{w}{br}I don't know what she's doing.",
            "remove_portrait;Simon",
            "end",
            "",
            "else",
            "move_unit;Simon;15,6;immediate;push",
            "end"
        ]
    }
]