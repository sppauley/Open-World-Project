[
    {
        "name": "WillemTalk",
        "trigger": "on_talk",
        "level_nid": "37",
        "condition": "unit2.nid == \"103\"",
        "commands": [],
        "only_once": false,
        "priority": 20,
        "_source": [
            "if;v(\"ArmsDealerUnlocked\") == False and v(\"AgreedToBuyFirstWeapon\") == None",
            "",
            "add_portrait;GenericMage;Right",
            "wait;400",
            "add_portrait;Simon;Left;left",
            "",
            "s;GenericMage;Psst, you!{w} Over here.",
            "s;Simon;Careful, knave. I am armed, and with a party.",
            "s;GenericMage;I am no threat to you! No, no.|I wish to offer you a deal.",
            "s;Simon;Is that so?",
            "s;GenericMage;I have many connections within the capital.|For a modest fee, I could procure weapons for your group.",
            "s;Simon;Or run off with the gold I pay you.",
            "s;GenericMage;No, no. I know the value of repeat business.|For a low fee of 300 gold, you will not be disappointed.",
            "",
            "if;game.get_money() > 299",
            "",
            "    choice;buyfirstweapon;Pay 300 gold?;Yes,No",
            "    if;v('_last_choice') == 'Yes'",
            "        game_var;AgreedToBuyFirstWeapon;True",
            "        game_var;ArmsDealerUnlocked;True",
            "        give_money;-300",
            "        s;Simon;Very well, but I expect you to make good on your word.",
            "        s;GenericMage;Of course. Return soon, and I will have quite the find for you.",
            "    else",
            "        s;Simon;I know better than to spend my army's money on your promises.",
            "        s;GenericMage;Perhaps! But these are dangerous times,|and risks ought to be taken.|Nevertheless, it is your decision.|I will remain here, if you wish to rethink it.",
            "    end",
            "    ",
            "else",
            "",
            "    s;Simon;You cannot expect me to take your proposal seriously.|Find another commander to swindle.",
            "    s;GenericMage;Ha! I'm sorry that you will be losing out, my friend.|Perhaps your coin purse is feeling a tad light?",
            "    s;Simon;Enough! I can't listen to you any longer.",
            "",
            "end",
            "",
            "multi_remove_portrait;Simon;GenericMage",
            "",
            "elif;v(\"ArmsDealerMapsLeft\") == 0 and v(\"FirstWeaponReceived\") == None",
            "",
            "add_portrait;GenericMage;Right",
            "wait;400",
            "add_portrait;Simon;Left;left",
            "",
            "s;GenericMage;Ah, Lord Verstadt!{w} Perfectly timed.",
            "s;Simon;I don't recall introducing myself through my title.",
            "s;GenericMage;Indeed, you did not.{w} Now for the prize you returned for.",
            "give_item;Simon;Pocketpoacher",
            "",
            "s;Simon;What's this?",
            "s;GenericMage;A contraption dreamed up by a few capital inventors.|It will more than make up for your payment.",
            "s;Simon;Hmm.",
            "s;GenericMage;There is also a further matter for us to discuss.",
            "s;Simon;You wish to renegotiate our deal?{w} That's a bold choice.",
            "s;GenericMage;Merely to extend it!{w} To be clear, this is a one-time opportunity.",
            "s;Simon;I'm listening.",
            "s;GenericMage;A contact of mine has a lead on a protected tome.|One of the weapons that was banned a few monarchs ago.",
            "s;Simon;I'm familiar with them. And you could retrieve it?",
            "# Willam tells Simon it's temporary opportunity, one time chance to pay the 400",
            "s;GenericMage;Yes, but this is a limited time opportunity.|The tome is in transit only for now.",
            "",
            "if;game.get_money() > 399",
            "",
            "    choice;buyfirstweapon;Pay 400 gold?;Yes,No",
            "    if;v('_last_choice') == 'Yes'  ",
            "        game_var;ArmsDealerMapsLeft;v(\"MAXMapsToArmsDealerUnlock\")",
            "        give_money;-400",
            "        s;GenericMage;Excellent! You will again thank yourself for this purchase.|Return soon, for you have much to expect.",
            "    else",
            "        game_var;ArmsDealerMapsLeft;-1",
            "        s;Simon;I'm still not convinced in your reliability,{w} nor that this tome will be worthwhile.|I've heard some of those protected tomes are barely more than dust now.",
            "        s;GenericMage;What a naive perspective!{w} Fine, reject me if you must. But you will regret your choice!",
            "    end",
            "else",
            "",
            "    s;Simon;Though you have been helpful, I can't spare the funds.",
            "    s;GenericMage;Ah, a shame!{w} I'm always sad to see a business partner go.",
            "    game_var;ArmsDealerMapsLeft;-1",
            "",
            "end",
            "",
            "game_var;FirstWeaponReceived;True",
            "",
            "elif;v(\"ArmsDealerMapsLeft\") == 0 and v(\"FirstWeaponReceived\") != None",
            "",
            "s;GenericMage;Lord Verstadt, I am excited to present you with...",
            "# If Alina is recruited, have her jump in here",
            "give_item;Simon;Immolation",
            "s;GenericMage;Can you feel its power course through you?",
            "s;Simon;I'm no mage myself, but this is clearly ancient.",
            "s;GenericMage;Indeed.{w} I'm afraid I must take my leave, however.|My work here has drawn... attention.|Best of luck, Lord Verstadt. Perhaps we will meet again some day?",
            "",
            "game_var;ArmsDealerGone;True",
            "",
            "end"
        ]
    }
]