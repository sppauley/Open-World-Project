[
    {
        "name": "MitziSkillTalk",
        "trigger": "on_talk",
        "level_nid": "MorrisseyCastleRoam",
        "condition": "unit2.nid == \"Mitzi\"",
        "commands": [],
        "only_once": false,
        "priority": 20,
        "_source": [
            "# This level_var is a list",
            "level_var;ChosenSkill;static_random.shuffle(DB.skills.get_feats())[0]",
            "",
            "# Make sure this isn't abusable",
            "",
            "# Add first time dialogue and such",
            "",
            "if;v(\"MapsToSkillUnlock\") > 0",
            "    add_portrait;Simon;Left",
            "    add_portrait;Mitzi;Right;mirror",
            "    s;Mitzi;Hmm... what is it?{w} Yes, yes, I'll be done soon.|Now, if you'll let me return to my reading...",
            "    move_portrait;Mitzi;OffscreenRight",
            "else",
            "",
            "    add_portrait;Simon;Left",
            "    add_portrait;Mitzi;Right",
            "    s;Mitzi;Simon, I've discovered an interesting archive.|Take the time to provide me with your thoughts-|I believe this may be quite useful.",
            "    ",
            "    # About to be the most illegal shit you've ever seen",
            "    give_item;Morrissey;GenericManual;Simon;no_banner",
            "",
            "    for;skill;[s.nid for s in game.get_unit(\"109\").skills]",
            "        remove_skill;109;{skill};no_banner;no_warn",
            "    endf",
            "    give_skill;109;{e:static_random.shuffle(DB.skills.get_feats())[0].nid};no_banner",
            "    ",
            "    # We use idx 3 because we can't remove global skills",
            "    level_var;SkillNid;game.get_unit(\"109\").skills[3].nid",
            "    level_var;SkillName;game.get_unit(\"109\").skills[3].name",
            "    level_var;SkillDesc;\"Grants \" + v(\"SkillName\") + \":\\n\" + game.get_unit(\"109\").skills[3].desc",
            "    for;skill;[s.nid for s in game.get_unit(\"109\").skills]",
            "        remove_skill;109;{skill};no_banner;no_warn",
            "    endf",
            "",
            "    change_item_name;Morrissey;GenericManual;{v:SkillName}",
            "    change_item_desc;Morrissey;GenericManual;{v:SkillDesc}",
            "    add_item_component;Morrissey;GenericManual;status_on_hit;v(\"SkillNid\")",
            "    # Make sure to do condition/skill rework",
            "    # Do custom alert",
            "",
            "    move_item;Morrissey;convoy;GenericManual",
            "",
            "end",
            ""
        ]
    }
]