[
    {
        "name": "MitziSkillTalk",
        "trigger": "on_talk",
        "level_nid": "MorrisseyCastleRoam",
        "condition": "unit2.nid == \"Mitzi\"",
        "commands": [],
        "only_once": false,
        "priority": 19,
        "_source": [
            "# Make sure this isn't abusable",
            "",
            "if;v(\"PossibleSkills\") is None",
            "    game_var;PossibleSkills;[skill.nid for skill in DB.skills.get_feats()]",
            "end",
            "",
            "# This is also skills that display as feats but cannot be obtained this way",
            "# I.e. Renewal, other dropped manuals",
            "if;v(\"ReceivedSkills\") is None",
            "    game_var;ReceivedSkills;[\"Renewal\", \"Sol\", \"Visceral\", \"Perceptive\"]",
            "end",
            "",
            "if;v(\"SkillIdx\") is None",
            "    game_var;SkillIdx;static_random.get_randint(0, len(v(\"PossibleSkills\")) - 1)",
            "end",
            "",
            "if;v(\"MapsToSkillUnlock\") > 0",
            "    add_portrait;Simon;Left",
            "    add_portrait;Mitzi;Right;mirror",
            "    s;Mitzi;Hmm... what is it?{w} Yes, yes, I'll be done soon.|Now, if you'll let me return to my reading...",
            "    move_portrait;Mitzi;OffscreenRight",
            "",
            "else",
            "",
            "    add_portrait;Simon;Left",
            "    add_portrait;Mitzi;Right",
            "    s;Mitzi;Simon, I've discovered an interesting archive.|Take the time to provide me with your thoughts-|I believe this may be quite useful.",
            "    ",
            "    end_skip",
            "    ",
            "    # About to be the most illegal shit you've ever seen",
            "    give_item;Morrissey;GenericManual;Simon;no_banner",
            "",
            "    for;skill;[s.nid for s in game.get_unit(\"109\").skills if not any([s.nid == t for t in v(\"ReceivedSkills\")])]",
            "        remove_skill;109;{skill};no_banner;no_warn",
            "    endf",
            "    give_skill;109;{e:v(\"PossibleSkills\")[int(v(\"SkillIdx\"))]};no_banner",
            "#{e:static_random.shuffle(v(\"PossibleSkills\"))[0]}",
            "    ",
            "    level_var;SkillNid;game.get_unit(\"109\").skills[-1].nid",
            "    level_var;SkillName;game.get_unit(\"109\").skills[-1].name",
            "    level_var;SkillDesc;\"Grants \" + v(\"SkillName\") + \":\\n\" + game.get_unit(\"109\").skills[-1].desc",
            "    level_var;SkillIcon;'{v:SkillNid}'+'_book'",
            "",
            "    if;v(\"ReceivedSkills\").append(v(\"SkillNid\"))",
            "    end",
            "    if;v(\"PossibleSkills\").remove(v(\"SkillNid\"))",
            "    end",
            "",
            "    change_item_name;Morrissey;GenericManual;{v:SkillName}",
            "    change_item_desc;Morrissey;GenericManual;{v:SkillDesc}",
            "    change_item_icon;Morrissey;GenericManual;{v:SkillIcon}",
            "    add_item_component;Morrissey;GenericManual;status_on_hit;v(\"SkillNid\")",
            "    # Make sure to do condition/skill rework",
            "    sound;Item",
            "    alert;The {e:v(\"SkillName\")} Manual was placed in the convoy;;{v:SkillNid}",
            "",
            "    for;skill;[s.nid for s in game.get_unit(\"109\").skills]",
            "        remove_skill;109;{skill};no_banner;no_warn",
            "    endf",
            "",
            "    move_item;Morrissey;convoy;GenericManual",
            "",
            "    # For next time :)",
            "    game_var;SkillIdx;static_random.get_randint(0, len(v(\"PossibleSkills\")))",
            "    game_var;MapsToSkillUnlock;v(\"MAXMapsToSkillUnlock\")",
            "",
            "end"
        ]
    }
]